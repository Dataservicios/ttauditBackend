<!doctype html>
<html lang="sp">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"/>
    <title>Document</title>
    <link rel="apple-touch-icon" sizes="57x57" href="favicons/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="114x114" href="favicons/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="72x72" href="favicons/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="144x144" href="favicons/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="60x60" href="favicons/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="120x120" href="favicons/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="76x76" href="favicons/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="152x152" href="favicons/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="favicons/apple-touch-icon-180x180.png">
    <link rel="icon" type="image/png" href="favicons/favicon-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="favicons/favicon-160x160.png" sizes="160x160">
    <link rel="icon" type="image/png" href="favicons/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="favicons/favicon-16x16.png" sizes="16x16">
    <link rel="icon" type="image/png" href="favicons/favicon-32x32.png" sizes="32x32">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-TileImage" content="favicons/mstile-144x144.png">
    <link rel="stylesheet" href="css/bootstrap.min.css"/>
    <link rel="stylesheet" href="css/stylesheet.min.css"/>

    <link rel="stylesheet" href="css/mapa-styles.css"/>
    <style>

        .controles{
            padding: 15px 0;
        }


        .panel-derecho {
            z-index: 20;
            position: absolute;
            top: 28px;
            right: 0px;
            color: #FFF;
            /* padding: 5px; */
            height: 16px;
            width: 14px;
            cursor: pointer;
            /*background: #333 url("../img/arrow.png");*/
        }
        #tools {
            float: right;
            z-index: 10;
            position: absolute;
            top: 28px;
            right: 0px;
            background: #333;
            color: #FFF;
            padding: 20px;
            width: auto;
            opacity: .75;
            -moz-opacity: .75;
            filter: alpha(opacity=75);
            /* visibility: visible; */
        }
        #tools h1 {

            font-size: 18px;
        }

        .btn-print {

            background: #fff1f1;
            margin: 10px 0 10px 0;
            padding: 5px;
            text-decoration: none;
            color: #000000;
        }

        /* Z-index of #mask must lower than #boxes .window */

        #mask {
            position:absolute;
            z-index:9000;
            background-color:#000;
            display:none;
        }

        #boxes .window {
            position:fixed;
            width:440px;
            height:200px;
            display:none;
            z-index:9999;
            padding:20px;
        }

        /* Customize your modal window here, you can add background image too */
        #boxes #dialog {
            width: 375px;
            height: 203px;
            padding: 10px;
            background-color: #ffffff;
            margin: auto;
            top:125px;
            left: 0;
            right: 0;

        }
        #puntosEmpresa a  {

            color: #ffffff ;

        }
    </style>
</head>
<body>
    <div class="container-full-width">


        <section>
            <!-- Filtron HOme-->
            <div class="cuerpo">
                <div class="cuerpo-content">
                    <div class="row">
                        <div class="col-md-12">

                            <!--Filtros con combos-->
                            <form>
                                <div class="row">
                                    <div class="col-sm-3">
                                        <div class="form-group">
                                            <label for="ciudad">TELEFONO</label>
                                            <select class="form-control" id="ciudad">
                                                <option>99999999</option>

                                            </select>
                                        </div>
                                    </div>



                                </div>

                            </form>
                            <!-- Fin Filtros con combos-->
                        </div>

                    </div>
                </div>
            </div>
            <!-- Filtrotro end-->
           <!-- Section Map-->
                <div >
                        <!--sección titulo y buscador-->
                        <div class="row">
                            <div class="col-sm-12">
                                <div class="contenedor">




                                    <div id="control" class="panel-derecho"></div>
                                    <div id="tools" style="visibility: visible;">
                                        <h1>PANEL DE CONTROL</h1>
                                        <div>
                                            <p style="border: 0; margin: 4px ; border-bottom: 1px dotted #ffffff">Usuario: <span id="usuarioName"></span></p>
                                        </div>

                                        <div>
                                            <p style="border: 0; margin: 4px ; border-bottom: 1px dotted #ffffff">Latitud Longitude

                                                <span id="lat"></span>
                                                <span id="lon"></span>
                                            </p>
                                        </div>

                                        <div>
                                            <p style="border: 0; margin: 4px ; border-bottom: 1px dotted #ffffff">Nº de PDVS: <span id="pdv"></span></p>
                                        </div>

                                        <div id="puntosEmpresa">

                                        </div>
                                        <!--<div>-->
                                            <!--<p style="border: 0; margin: 4px ; border-bottom: 1px dotted #ffffff">Selecionados: <span id="pdvSelected"></span></p>-->
                                        <!--</div>-->
                                        <!--<div id="tiendas"></div>-->
                                        <!--<div>-->
                                            <!--<button id="guardar" type="submit" class="btn btn-default">Guardar RUTA</button>-->
                                        <!--</div>-->
                                    </div>
                                    <!-- MAPA CANVAS -->
                                    <div id="map_canvas">
                                        <!-- css3 preLoading-->
                                        <div class="mapPerloading"> <span>Cargando</span>
                                            <span class="l-1"></span>
                                            <span class="l-2"></span>
                                            <span  class="l-3"></span>
                                            <span class="l-4"></span>
                                            <span class="l-5"></span>
                                            <span class="l-6"></span>
                                        </div>
                                    </div>
                                    <!-- END MAPA CANVAS -->
                                    <a href=""></a>



                                </div>
                            </div>

                        </div>

                </div>

            <!--end section map -->


        </section>
        <footer>

        </footer>
    </div>
    <script type="text/javascript" src="lib/jquery.js"></script>
    <script type="text/javascript" src="js/scrollspy.js"></script>
    <script type="text/javascript" src="js/dropdown.js"></script>
    <script type="text/javascript" src="js/collapse.js"></script>
    <script type="text/javascript" src="js/tooltip.js"></script>
    <script type="text/javascript" src="lib/bootstrap.min.js"></script>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD7tL9pwWTxpywD6zMUDw32yaml7lr9oi4"></script>
    <!--<script type="text/javascript"    src="http://maps.googleapis.com/maps/api/js?key=AIzaSyD7tL9pwWTxpywD6zMUDw32yaml7lr9oi4&sensor=false">  </script>-->
    <!--<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD7tL9pwWTxpywD6zMUDw32yaml7lr9oi4&callback=initMap"   type="text/javascript"></script>-->

    <script type="text/javascript" src="lib/mapa/infobox.js"></script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip();

            $('.dropdown-toggle').dropdown()
        })
    </script>




    <script>

        $('#usuarioName').html('jaime');
        $(document).ready(function() {
            // var $elem = $("#contenido");
            //var docwidth =  $(document).width();
            //var inileft = docwidth - $elem.outerWidth();
            //$elem.css("left", inileft);  //Position element tho the right
            $("#control").click(function () {  //This slides
                //alert("hola");
                // $elem.animate({
                //   left: (parseInt($elem.css("left"), 10) >= docwidth ?  inileft : docwidth)

                // });
                if($("#tools").css("visibility")=="visible"){
                    $("#tools").css("visibility","hidden");
                }else {

                    $("#tools").css("visibility","visible");
                }

            });
        });

        var _map;
        //var _geocoder;
        var _markers=[];
        var _infoBox;
        var countIBK=0,countBayer= 0,countAlicorp= 0,countAlicorpAASS=0, countKasnet=0 , countFullCarga=0, countBCP=0 ,countBIM=0;
        var dominio = "http://ttaudit.com";
        //var dominio = "http://localhost/ttaudit.com/backend/ttaudit1/public";


        // var marker;
        $(document).ready(function($) {


            function init () {
                setupMapa(jQuery('#map_canvas')[0]);
            }
            function setupMapa(div){
                // Carga los datos de las burbujas de un JSON externo
                //lib/mapa/burbujas.json
                $.post(dominio + '/getPhone' , { phone : "8951063121604731251" },  function(data) {

                        })
                        .done(function(data) {
                            //
                            console.log(data.length);

                                _map= new google.maps.Map( div, {
                                            scrollwheel: true,
                                            zoom: 16,
                                            center: new google.maps.LatLng(data.objeto[0].latitud, data.objeto[0].longitud),
                                            disableDefaultUI: false,
                                            mapTypeId: google.maps.MapTypeId.ROADMAP
                                        }
                                );


                            populateMap(data.objeto);
                        })
                        .fail(function() {
                            //
                            console.log("Error");
                        })
                        .always(function() {
                            // alert( "finished" );
                            console.log("always");
                        });


//                $.post(dominio + '/json/location.php',{ departament : "1" }, function(json){
//
//                    //if (item.latitud != 0 && item.longitud != 0){
//                    console.log(json.length);
//                    if(json.length==0){
//                        _map= new google.maps.Map( div, {
//                                    scrollwheel: true,
//                                    zoom: 16,
//                                    center: new google.maps.LatLng('-12.046612','-77.042096'),
//                                    disableDefaultUI: false,
//                                    mapTypeId: google.maps.MapTypeId.ROADMAP
//                                }
//                        );
//                        $('#guardar').css({'display':'none'});
//
//                    } else {
//                        _map= new google.maps.Map( div, {
//                                    scrollwheel: true,
//                                    zoom: 16,
//                                    center: new google.maps.LatLng(json[0].latitude_store, json[0].longitude_store),
//                                    disableDefaultUI: false,
//                                    mapTypeId: google.maps.MapTypeId.ROADMAP
//                                }
//                        );
//
//                    }
//
//                    populateMap(json);
//                });
            }

            //----------------------- ---
            // Rellena el mapa de burbujitas con los datos del json
            function populateMap(data){

                var total_puntos = 0;
                $.each(data, function(i, item){
                    // console.log(item);

                    total_puntos ++;
                    var icono_store;
                    icono_store='img/maker_gps.png';
                    var marker = new google.maps.Marker({
                        id 		:i,
                        clickable 	:true,
                        draggable:true,
                        position  	:new google.maps.LatLng(item.latitud, item.longitud),
                        animation 	:google.maps.Animation.DROP,
                        icon      	:icono_store,
                        origin 		:(18, 38),   // Desfase del png de la burbuja con respecto al punto
                        map      	:_map
                    });

                    moveMarker(  marker );


                    // Escucho los eventos de raton sobre las burbujas
                    //if(item.status=="true") {
                    google.maps.event.addListener(marker, 'click', function() {
                        openInfoBox(marker, item, icono_store);
                    });

                    google.maps.event.addListener(marker, 'dragend', function() {
                        openInfoBox(marker, item, icono_store);
                    });

                    google.maps.event.addListener(marker, 'drag', function() {
                        //updateMarkerStatus('Dragging...');
                        updateMarkerPosition(marker.getPosition());
                    });


                    _markers[i] = marker;



                });

                function moveMarker( marker ) {

                    setInterval( function () {
                        refreshMarker(marker)
                    } , 25000 );

                };

                function refreshMarker(marker){

                    $.post(dominio + '/getPhone' , { phone : "8951063121604731251" },  function(data) {

                    })
                    .done(function(data) {
                        //
                        marker.setPosition( new google.maps.LatLng(data.objeto[0].latitud , data.objeto[0].longitud) );
                        _map.panTo( new google.maps.LatLng(data.objeto[0].latitud , data.objeto[0].longitud) );  // Centra el mapa a la nueva posición del latidud y longitud

                    })
                    .fail(function() {
                        //
                        console.log("Error");
                    })
                    .always(function() {
                        // alert( "finished" );
                        console.log("always");
                    });

                }



                function updateMarkerPosition(latLng) {
                    document.getElementById('lat').innerHTML = [
                        latLng.lat(),
                        latLng.lng()
                    ].join(', ');

                }

                function updateMarkerStatus(str) {
                    document.getElementById('markerStatus').innerHTML = str;
                }



                function updateMarkerAddress(str) {

                    document.getElementById('address').innerHTML = str;
                }


                // Abre la ventana de info cuando se hace click sobre una burbuja
                function openInfoBox(marker, item,icono) {
                    _map.panTo(marker.position);
                    var myOptions = {
                        // content 			:createInfoboxHtml(item.cadenaRuc,item.tipo,item.codclient, item.fullname, item.departamento, item.address, item.referencia, item.district ,item.id, item.company_id)
                        content 			:createInfoboxHtml(item.phone,item.sdk,item.updated_at)
                        ,alignBottom 			:true
                        ,disableAutoPan 		:false
                        ,maxWidth 			:0
                        ,pixelOffset 			:new google.maps.Size(-114, -55) // Desfase del cartel con respecto a la burbuja
                        ,zIndex 			:null
                        ,closeBoxURL 			:""
                        ,infoBoxClearance 		:new google.maps.Size(0, 60) // margen superior del cartel con el borde superior del mapa
                        ,isHidden 			:false
                        ,pane 				:"floatPane"
                        ,enableEventPropagation 	:false
                        ,zoom					:15

                    };

                    // Si ya hay un infoBox abierto lo cierro
                    if(_infoBox){
                        _infoBox.close();
                    }
                    _infoBox = new InfoBox(myOptions);
                    // Escucho el evento para poder cerrar la ventana de info
                    google.maps.event.addListener(_infoBox, 'domready', function() {
                        jQuery('.IFclose', '.infoBox').unbind('click', closeInfoBox);
                        jQuery('.IFclose', '.infoBox').bind('click', closeInfoBox);


                    });
                    //console.log(item);
                    _infoBox.open(_map, marker);
                }

                // Devuelve el HTML de la cartela de informacion de la burbuja
                //createInfoboxHtml(item.fullname, item.address, item.urbanization, item.district ,item.id)
                function createInfoboxHtml(phone,sdk,fecha) {
                    var boxText = document.createElement("div");

                    boxText.innerHTML = "<div class='IFcontainer'>"+
                            "<a href='#' class='IFclose'></a>"+
                            "<div id='IFtitleBox'>Telefono: "  + phone + "</div>"+
                            "<div class='contenido'>Android Versión : "+ sdk + "</div>"+
                            "<div class='contenido'>Fecha: "+ fecha + "</div>"+
                            "<div class='IFcorner'></div>"+
                            "</div>";
                    return boxText;
                }





                // Cierra la ventana de info
                function closeInfoBox(e){
                    e.preventDefault();
                    _infoBox.close();
                }

            }
            init();
        });


        //select all the a tag with name equal to modal
        $('#guardar').click(function(e) {
            //Cancel the link behavior
            e.preventDefault();
            //Get the A tag
            var id = $(this).attr('href');

            //Get the screen height and width
            var maskHeight = $(document).height();
            var maskWidth = $(window).width();

            //Set height and width to mask to fill up the whole screen
            $('#mask').css({'width':maskWidth,'height':maskHeight});

            //transition effect
            $('#mask').fadeIn(1000);
            $('#mask').fadeTo("slow",0.8);

            //Get the window height and width
            var winH = $(window).height();
            var winW = $(window).width();

            //Set the popup window to center
            $(id).css('top',  winH/2-$(id).height()/2);
            $(id).css('left', winW/2-$(id).width()/2);

            //transition effect
            $(id).fadeIn(2000);
            $('.window').show();
        });

        //if close button is clicked
        $('.window .close').click(function (e) {
            //Cancel the link behavior
            e.preventDefault();
            $('#mask, .window').hide();
        });

        //if mask is clicked
        $('#mask').click(function () {
            $(this).hide();
            $('.window').hide();
        });




    </script>
</body>
</html>